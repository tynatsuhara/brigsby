(()=>{"use strict";var t,e=function(){function t(t){var e=void 0===t?{}:t,n=e.awake,o=e.start,i=e.update,r=e.lateUpdate,s=e.getRenderMethods,u=e.delete;this.enabled=!0,this.awake=null!=n?n:this.awake,this.start=null!=o?o:this.start,this.update=null!=i?i:this.update,this.lateUpdate=null!=r?r:this.lateUpdate,this.getRenderMethods=null!=s?s:this.getRenderMethods,this.delete=null!=u?u:this.delete}return Object.defineProperty(t.prototype,"isStarted",{get:function(){return this.start===n},enumerable:!1,configurable:!0}),t.prototype.awake=function(t){},t.prototype.start=function(t){},t.prototype.update=function(t){},t.prototype.lateUpdate=function(t){},t.prototype.getRenderMethods=function(){return[]},t.prototype.delete=function(){var t;null===(t=this.entity)||void 0===t||t.removeComponent(this)},t}(),n=function(){throw new Error("start() has already been called on this component")},o=Object.assign({},{showColliders:!1,showProfiler:!1},(t=localStorage.getItem("debug_state"))?(console.log("loaded debug state from local storage"),JSON.parse(t)):{}),i=new Proxy(o,{set:function(t,e,n,i){var r=Reflect.set(t,e,n,i);return r&&localStorage.setItem("debug_state",JSON.stringify(o)),r}});window.debug=i,window.localStorageUsage=function(){var t,e,n=0;for(e in localStorage)localStorage.hasOwnProperty(e)&&(n+=t=2*(localStorage[e].length+e.length),console.log(e.substr(0,50)+" = "+(t/1024).toFixed(2)+" KB"));console.log("Total = "+(n/1024).toFixed(2)+" KB")};var r,s,u,a,c,p=function(){function t(t,e){this.x=t,this.y=e}return t.prototype.times=function(e){return new t(this.x*e,this.y*e)},t.prototype.div=function(e){return new t(this.x/e,this.y/e)},t.prototype.floorDiv=function(e){return new t(Math.floor(this.x/e),Math.floor(this.y/e))},t.prototype.plus=function(e){var n=e.x,o=e.y;return new t(this.x+n,this.y+o)},t.prototype.plusX=function(e){return new t(this.x+e,this.y)},t.prototype.plusY=function(e){return new t(this.x,this.y+e)},t.prototype.minus=function(e){var n=e.x,o=e.y;return new t(this.x-n,this.y-o)},t.prototype.lerp=function(e,n){var o=n.x,i=n.y,r=Math.max(Math.min(e,1),0);return this.plus(new t(o,i).minus(this).times(r))},t.prototype.distanceTo=function(t){var e=t.x,n=t.y,o=e-this.x,i=n-this.y;return Math.sqrt(o*o+i*i)},t.prototype.manhattanDistanceTo=function(t){var e=t.x,n=t.y;return Math.abs(e-this.x)+Math.abs(n-this.y)},t.prototype.magnitude=function(){return this.distanceTo(new t(0,0))},t.prototype.normalized=function(){var t=this.magnitude();if(0===this.x&&0===this.y)throw new Error("cannot normalize a vector with magnitude 0");return this.div(t)},t.prototype.normalizedOrZero=function(){var t=this.magnitude();return 0===t?this:this.div(t)},t.prototype.toString=function(){return"(".concat(this.x,",").concat(this.y,")")},t.fromString=function(e){var n=e.replace("(","").replace(")","").split(",").map((function(t){return Number.parseInt(t)}));return new t(n[0],n[1])},t.prototype.equals=function(t){var e=t.x,n=t.y;return h&&e==this.x&&n==this.y},t.prototype.apply=function(e){return new t(e(this.x),e(this.y))},t.prototype.randomlyShifted=function(e,n){return void 0===n&&(n=e),this.plus(new t(e-Math.random()*e*2,n-Math.random()*n*2))},t.prototype.randomCircularShift=function(e){var n=2*Math.random()*Math.PI,o=e*Math.sqrt(Math.random());return this.plus(new t(o*Math.cos(n),o*Math.sin(n)))},t.prototype.rotatedAround=function(e,n){var o=this.x,i=this.y,r=e.x,s=e.y,u=Math.PI/180*-n,a=Math.cos(u),c=Math.sin(u);return new t(a*(o-r)+c*(i-s)+r,a*(i-s)-c*(o-r)+s)},t.ZERO=new t(0,0),t}(),h=function(t,e){return new p(t,null!=e?e:t)},l=function(t){this.depth=t},f=(r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},r(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),y=function(t){function e(e,n,o,i){void 0===o&&(o="#ff0000"),void 0===i&&(i=1);var r=t.call(this,Number.MAX_SAFE_INTEGER)||this;return r.start=e,r.end=n,r.color=o,r.width=i,r}return f(e,t),e.prototype.render=function(t){t.lineWidth=this.width,t.strokeStyle=this.color,t.beginPath(),t.moveTo(this.start),t.lineTo(this.end),t.stroke()},e}(l),d=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),w=function(t){function e(e,n,o){void 0===n&&(n=v.DEFAULT_LAYER),void 0===o&&(o=[]);var i=t.call(this)||this;return i._position=e,i.layer=n,i.ignoredColliders=o,i}return d(e,t),Object.defineProperty(e.prototype,"position",{get:function(){return this._position},enumerable:!1,configurable:!0}),e.prototype.moveTo=function(t,e){if(void 0===e&&(e=!0),!this.enabled)return this._position=t,this.position;var n=t.x-this.position.x,o=t.y-this.position.y;return m._canTranslate(this,new p(n,o))?this._position=t:e&&(m._canTranslate(this,new p(n,0))?this._position=this._position.plus(new p(n,0)):m._canTranslate(this,new p(0,o))&&(this._position=this._position.plus(new p(0,o)))),this.position},e.prototype.forceSetPosition=function(t){return this._position=t,this.position},e.prototype.getRenderMethods=function(){if(!i.showColliders)return[];for(var t=this.getPoints(),e=[],n=t[t.length-1],o=0,r=t;o<r.length;o++){var s=r[o];e.push(new y(s,n,"#ff0000")),n=s}return e},e.prototype.lineCast=function(t,e){for(var n=null,o=0,i=this.getPoints(),r=i[i.length-1],s=0,u=i;s<u.length;s++){var a=u[s],c=this.lineIntersect(a,r,t,e);if(c){var p=c.distanceTo(t);(null==n||p<o)&&(n=c,o=p)}r=a}return n},e.prototype.checkWithinBoundsAfterTranslation=function(t,e){var n=this;this._position=this._position.plus(t);var o=e.getPoints().some((function(t){return n.isWithinBounds(t)}));return this._position=this._position.minus(t),o},e.prototype.lineIntersect=function(t,e,n,o){var i=t.x,r=t.y,s=e.x,u=e.y,a=n.x,c=n.y,h=o.x,l=o.y;if((i-s)*(c-l)-(r-u)*(a-h)==0)return null;var f=(i-a)*(c-l)-(r-c)*(a-h),y=-((i-s)*(r-c)-(r-u)*(i-a)),d=(i-s)*(c-l)-(r-u)*(a-h);if(f>=0&&f<=d&&y>=0&&y<=d){var w=f/d;return new p(i+w*(s-i),r+w*(u-r))}return null},e}(e),v=function(){function t(){this.colliderMap=new Map,this.setCollisionMatrix(new Map)}return t.prototype.setCollisionMatrix=function(e){var n=new Map;n.set(t.DEFAULT_LAYER,new Set([t.DEFAULT_LAYER]));for(var o=0,i=Array.from(e.keys());o<i.length;o++)for(var r=i[o],s=0,u=e.get(r);s<u.length;s++){var a=u[s];n.has(r)||n.set(r,new Set),n.get(r).add(a),n.has(a)||n.set(a,new Set),n.get(a).add(r)}this.matrix=n},t.prototype._setViewContext=function(t){var e=this;this.colliderMap.clear(),t.forEach((function(t){var n=t.entities.filter((function(t){return!!t})).flatMap((function(t){return t.getComponents(w)}));n.forEach((function(t){return e.colliderMap.set(t,n)}))}))},t.prototype._canTranslate=function(t,e){var n=t,o=n.position.plus(e);return!this.getCollidable(t).some((function(t){var e=t;return!(o.x>e.position.x+e.dimensions.x||o.y>e.position.y+e.dimensions.y||o.x+n.dimensions.x<e.position.x||o.y+n.dimensions.y<e.position.y)&&(n.position.x>=e.position.x+e.dimensions.x||n.position.y>=e.position.y+e.dimensions.y||n.position.x+n.dimensions.x<=e.position.x||n.position.y+n.dimensions.y<=e.position.y)}))},t.prototype.getCollidable=function(t){var e=this.matrix.get(t.layer);if(!e||0===e.size)return[];var n=this.colliderMap.get(t);return n?n.filter((function(n){return n!==t&&n.enabled&&e.has(n.layer)&&-1===t.ignoredColliders.indexOf(n)&&-1===n.ignoredColliders.indexOf(t)})):[]},t.DEFAULT_LAYER="default",t}(),m=new v;!function(t){t[t.DOWN=0]="DOWN",t[t.HELD=1]="HELD",t[t.UP=2]="UP"}(s||(s={})),function(t){t.ZERO="Digit0",t.ONE="Digit1",t.TWO="Digit2",t.THREE="Digit3",t.FOUR="Digit4",t.FIVE="Digit5",t.SIX="Digit6",t.SEVEN="Digit7",t.EIGHT="Digit8",t.NINE="Digit9",t.Q="KeyQ",t.W="KeyW",t.E="KeyE",t.R="KeyR",t.T="KeyT",t.Y="KeyY",t.U="KeyU",t.I="KeyI",t.O="KeyO",t.P="KeyP",t.A="KeyA",t.S="KeyS",t.D="KeyD",t.F="KeyF",t.G="KeyG",t.H="KeyH",t.J="KeyJ",t.K="KeyK",t.L="KeyL",t.Z="KeyZ",t.X="KeyX",t.C="KeyC",t.V="KeyV",t.B="KeyB",t.N="KeyN",t.M="KeyM",t.MINUS="Minus",t.EQUALS="Equal",t.BACKSPACE="Backspace",t.BRACKET_LEFT="BracketLeft",t.BRACKET_RIGHT="BracketRight",t.BACKSLASH="Backslash",t.COMMA="Comma",t.PERIOD="Period",t.SLASH="Slash",t.SHIFT_RIGHT="ShiftRight",t.TAB="Tab",t.SHIFT="ShiftLeft",t.CONTROL="ControlLeft",t.SPACE="Space",t.ESC="Escape",t.SEMICOLON="Semicolon",t.QUOTE="Quote",t.UP="ArrowUp",t.DOWN="ArrowDown",t.LEFT="ArrowLeft",t.RIGHT="ArrowRight"}(u||(u={})),function(t){t[t.X=0]="X",t[t.CIRCLE=1]="CIRCLE",t[t.SQUARE=2]="SQUARE",t[t.TRIANGLE=3]="TRIANGLE",t[t.L1=4]="L1",t[t.R1=5]="R1",t[t.L2=6]="L2",t[t.R2=7]="R2",t[t.SELECT=8]="SELECT",t[t.START=9]="START",t[t.L3=10]="L3",t[t.R3=11]="R3",t[t.UP=12]="UP",t[t.DOWN=13]="DOWN",t[t.LEFT=14]="LEFT",t[t.RIGHT=15]="RIGHT",t[t.SUPER=16]="SUPER",t[t.TOUCHPAD=17]="TOUCHPAD"}(a||(a={})),function(t){t[t.LEFT=0]="LEFT",t[t.RIGHT=2]="RIGHT"}(c||(c={}));var g=function(){function t(t){var e=this;this.keys=new Set,this.lastCapture=new M,this.mousePos=new p(0,0),this.isMouseDown=!1,this.isMouseHeld=!1,this.isMouseUp=!1,this.isRightMouseDown=!1,this.isRightMouseHeld=!1,this.isRightMouseUp=!1,this.mouseWheelDeltaY=0,t.oncontextmenu=function(){return!1},t.onmousedown=function(t){t.button===c.LEFT?(e.isMouseDown=!0,e.isMouseHeld=!0,e.isMouseUp=!1):t.button==c.RIGHT&&(e.isRightMouseDown=!0,e.isRightMouseHeld=!0,e.isRightMouseUp=!1)},t.onmouseup=function(t){t.button===c.LEFT?(e.isMouseDown=!1,e.isMouseHeld=!1,e.isMouseUp=!0):t.button===c.RIGHT&&(e.isRightMouseDown=!1,e.isRightMouseHeld=!1,e.isRightMouseUp=!0)},t.onmousemove=function(n){return e.mousePos=new p(n.x-t.offsetLeft,n.y-t.offsetTop)},t.onwheel=function(t){return e.mouseWheelDeltaY=t.deltaY},window.onkeydown=function(t){return e.keys.add(e.captureKey(t).code)},window.onkeyup=function(t){return e.keys.delete(e.captureKey(t).code)}}return t.prototype.captureInput=function(){var t=this,e=Array.from(this.keys),n=new M(new Set(e.filter((function(e){return!t.lastCapture.isKeyHeld(e)}))),new Set(e.slice()),new Set(this.lastCapture.getKeysHeld().filter((function(e){return!t.keys.has(e)}))),this.mousePos,this.mousePos.minus(this.lastCapture.mousePos),this.isMouseDown,this.isMouseHeld,this.isMouseUp,this.isRightMouseDown,this.isRightMouseHeld,this.isRightMouseUp,this.mouseWheelDeltaY,this.captureGamepads());return this.isMouseDown=!1,this.isMouseUp=!1,this.isRightMouseDown=!1,this.isRightMouseUp=!1,this.mouseWheelDeltaY=0,this.lastCapture=n,this.lastCapture},t.prototype.captureKey=function(t){return t.code===u.TAB&&t.preventDefault(),t},t.prototype.captureGamepads=function(){var t=this;return Object.values(navigator.getGamepads()||[]).map((function(e,n){if(e){var o=new Map;e.buttons.forEach((function(t,e){return o.set(e,t.value)}));var i=t.lastCapture.gamepads[n];return new x(e,o,i)}}))},t}(),x=function(){function t(t,e,n){this.gamepad=t,this.buttonValues=e,this.lastValues=(null==n?void 0:n.buttonValues)||new Map}return t.prototype.getLeftAxes=function(){return new p(this.gamepad.axes[0],this.gamepad.axes[1])},t.prototype.getRightAxes=function(){return new p(this.gamepad.axes[2],this.gamepad.axes[3])},t.prototype.isButtonDown=function(t){return!(this.lastValues.get(t)||!this.buttonValues.get(t))},t.prototype.isButtonHeld=function(t){return!!this.buttonValues.get(t)},t.prototype.isButtonUp=function(t){return!!this.lastValues.get(t)&&!this.buttonValues.get(t)},t.prototype.isButton=function(t,e){switch(e){case s.DOWN:return this.isButtonDown(t);case s.HELD:return this.isButtonHeld(t);case s.UP:return this.isButtonUp(t)}},t.prototype.getButtonValue=function(t){return this.buttonValues.get(t)},t.prototype.vibrate=function(t){var e=void 0===t?{}:t,n=e.duration,o=void 0===n?1e3:n,i=e.strongMagnitude,r=void 0===i?1:i,s=e.weakMagnitude,u=void 0===s?1:s,a=this.gamepad.vibrationActuator;a&&"function"==typeof a.playEffect&&a.playEffect("dual-rumble",{duration:o,strongMagnitude:r,weakMagnitude:u})},t}(),M=function(){function t(t,e,n,o,i,r,s,u,a,c,h,l,f){void 0===t&&(t=new Set),void 0===e&&(e=new Set),void 0===n&&(n=new Set),void 0===o&&(o=new p(0,0)),void 0===i&&(i=new p(0,0)),void 0===r&&(r=!1),void 0===s&&(s=!1),void 0===u&&(u=!1),void 0===a&&(a=!1),void 0===c&&(c=!1),void 0===h&&(h=!1),void 0===l&&(l=0),void 0===f&&(f=[]),this.mousePos=new p(0,0),this.keysDown=t,this.keysHeld=e,this.keysUp=n,this.mousePos=o,this.mousePosDelta=i,this.isMouseDown=r,this.isMouseHeld=s,this.isMouseUp=u,this.isRightMouseDown=a,this.isRightMouseHeld=c,this.isRightMouseUp=h,this.mouseWheelDeltaY=l,this.gamepads=f}return t.prototype.scaledForView=function(e){return new t(this.keysDown,this.keysHeld,this.keysUp,this.mousePos.div(e.zoom).minus(e.offset),this.mousePosDelta,this.isMouseDown,this.isMouseHeld,this.isMouseUp,this.isRightMouseDown,this.isRightMouseHeld,this.isRightMouseUp,this.mouseWheelDeltaY,this.gamepads)},t.prototype.isMouse=function(t,e){if(t===c.LEFT)switch(e){case s.DOWN:return this.isMouseDown;case s.HELD:return this.isMouseHeld;case s.UP:return this.isMouseUp}else switch(e){case s.DOWN:return this.isRightMouseDown;case s.HELD:return this.isRightMouseHeld;case s.UP:return this.isRightMouseUp}},t.prototype.getKeysHeld=function(){return Array.from(this.keysUp)},t.prototype.isKeyDown=function(t){return this.keysDown.has(t)},t.prototype.isKeyHeld=function(t){return this.keysHeld.has(t)},t.prototype.isKeyUp=function(t){return this.keysUp.has(t)},t.prototype.isKey=function(t,e){switch(e){case s.DOWN:return this.isKeyDown(t);case s.HELD:return this.isKeyHeld(t);case s.UP:return this.isKeyUp(t)}},t}(),_=function(){function t(t){void 0===t&&(t=[]);var e=this;this.components=[],this.componentCache=new Map,t.forEach((function(t){return e.addComponent(t)}))}return t.prototype.addComponent=function(t){if(t)return this.componentCache.clear(),t.entity=this,this.components.push(t),t.awake({}),t},t.prototype.addComponents=function(t){var e=this;return t.forEach((function(t){return e.addComponent(t)})),t},t.prototype.getComponent=function(t){return this.getComponents(t)[0]},t.prototype.getComponents=function(t){var e=this.componentCache.get(t);return void 0===e&&(e=this.components.filter((function(e){return e instanceof t})),this.componentCache.set(t,e)),e},t.prototype.removeComponent=function(t){this.componentCache.clear(),this.components=this.components.filter((function(e){return e!==t})),t.entity=null},t.prototype.selfDestruct=function(){this.components.forEach((function(t){return t.delete()}))},t}(),E=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),O=function(t){function e(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var o=t.call(this)||this;return o.renders=e,o}return E(e,t),e.prototype.getRenderMethods=function(){return this.renders},e}(e),S=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),D=function(t){function e(e){var n=void 0===e?{}:e,o=n.depth,i=void 0===o?0:o,r=n.position,s=void 0===r?p.ZERO:r,u=n.dimensions,a=void 0===u?p.ZERO:u,c=n.color,h=void 0===c?"#ff0000":c,l=t.call(this,i)||this;return l.position=s,l.dimensions=a,l.color=h,l}return S(e,t),e.prototype.render=function(t){t.fillStyle=this.color,t.fillEllipse(this.position,this.dimensions)},e}(l),T=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),R=(function(t){function e(e,n,o,i,r,s,u,a,c){void 0===s&&(s=0),void 0===u&&(u=0),void 0===a&&(a=!1),void 0===c&&(c=!1);var p=t.call(this,s)||this;return p.source=e,p.sourcePosition=n,p.sourceDimensions=o,p.position=i,p.dimensions=r,p.rotation=u,p.mirrorX=a,p.mirrorY=c,p}T(e,t),e.prototype.render=function(t){t.drawImage(this.source,this.sourcePosition,this.sourceDimensions,this.position,this.dimensions,this.rotation,!1,this.mirrorX,this.mirrorY)}}(l),function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}()),b=function(t){function e(e){var n=void 0===e?{}:e,o=n.depth,i=void 0===o?0:o,r=n.position,s=void 0===r?p.ZERO:r,u=n.dimensions,a=void 0===u?p.ZERO:u,c=n.color,h=void 0===c?"#ff0000":c,l=t.call(this,i)||this;return l.position=s,l.dimensions=a,l.color=h,l}return R(e,t),e.prototype.render=function(t){t.fillStyle=this.color,t.fillRect(this.position,this.dimensions)},e}(l),P=function(){function t(t,e,n){this.canvas=t,this.context=e,this.view=n,this.width=t.width,this.height=t.height}return Object.defineProperty(t.prototype,"lineWidth",{set:function(t){this.context.lineWidth=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"strokeStyle",{set:function(t){this.context.strokeStyle=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"font",{set:function(t){this.context.font=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fillStyle",{set:function(t){this.context.fillStyle=t},enumerable:!1,configurable:!0}),t.prototype.measureText=function(t){return this.context.measureText(t)},t.prototype.fillText=function(t,e,n,o,i,r){var s=this.view.offset.times(this.view.zoom).apply(Math.floor);this.context.font="".concat(t*this.view.zoom,"px '").concat(e,"'"),this.context.fillStyle=n,i=i.times(this.view.zoom).apply(Math.floor).plus(s),this.context.textAlign=r,this.context.fillText(o,i.x,i.y+t*this.view.zoom)},t.prototype.fillEllipse=function(t,e){t=t.plus(this.view.offset).times(this.view.zoom);var n=e.times(this.view.zoom).div(2);this.context.beginPath(),this.context.ellipse(t.x+n.x,t.y+n.y,n.x,n.y,0,0,2*Math.PI),this.context.fill()},t.prototype.fillRect=function(t,e){t=t.plus(this.view.offset).times(this.view.zoom),e=e.times(this.view.zoom),this.context.fillRect(t.x,t.y,e.x,e.y)},t.prototype.drawImage=function(t,e,n,o,i,r,s,u,a){i=null!=i?i:n;var c=this.view.offset.times(this.view.zoom).apply(Math.floor),p=o.times(this.view.zoom).plus(c);s&&(p=this.pixelize(p));var h=i.times(this.view.zoom),l=Math.max(h.x,h.y);if(!(p.x>this.canvas.width+l||p.x+h.x<-l||p.y>this.canvas.height+l||p.y+h.y<-l)){this.context.save(),this.context.translate(Math.floor(p.x),Math.floor(p.y));var f=i.div(2).times(this.view.zoom);this.context.translate(f.x,f.y),this.context.rotate(r*Math.PI/180),this.context.scale(u?-1:1,a?-1:1),this.context.drawImage(t,e.x,e.y,n.x,n.y,-f.x,-f.y,h.x,h.y),this.context.restore()}},t.prototype.rotate=function(t){this.context.rotate(t)},t.prototype.scale=function(t,e){this.context.scale(t,e)},t.prototype.beginPath=function(){this.context.beginPath()},t.prototype.moveTo=function(t){t=t.plus(this.view.offset).times(this.view.zoom),this.context.moveTo(t.x,t.y)},t.prototype.lineTo=function(t){t=t.plus(this.view.offset).times(this.view.zoom),this.context.lineTo(t.x,t.y)},t.prototype.stroke=function(){this.context.stroke()},t.prototype.pixelize=function(t){return new p(t.x-t.x%this.view.zoom,t.y-t.y%this.view.zoom)},t}(),C=new(function(){function t(){}return t.prototype.getDimensions=function(){return new p(this.canvas.width,this.canvas.height)},t.prototype._setCanvas=function(t){this.canvas=t,this.context=t.getContext("2d",{alpha:!0}),this.resizeCanvas()},t.prototype._render=function(t){var e=this;this.resizeCanvas(),this.context.imageSmoothingEnabled=!1,this.context.clearRect(0,0,this.canvas.width,this.canvas.height),t.forEach((function(t){return e.renderView(t)}))},t.prototype.resizeCanvas=function(){this.canvas.width=this.canvas.clientWidth,this.canvas.height=this.canvas.clientHeight},t.prototype.renderView=function(t){var e=new P(this.canvas,this.context,t);t.entities.flatMap((function(t){return null==t?void 0:t.components})).filter((function(t){return!!t&&t.enabled&&t.isStarted})).flatMap((function(t){return t.getRenderMethods()})).filter((function(t){return!!t})).sort((function(t,e){return t.depth-e.depth})).forEach((function(t){return t.render(e)}))},t}()),A=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),U=function(t){function e(e,n,o,i,r,s,u){void 0===o&&(o=20),void 0===i&&(i="Comic Sans MS Regular"),void 0===r&&(r="red"),void 0===s&&(s=0),void 0===u&&(u="start");var a=t.call(this,s)||this;return a.text=e,a.position=n,a.size=o,a.font=i,a.color=r,a.alignment=u,a}return A(e,t),e.prototype.render=function(t){t.fillText(this.size,this.font,this.color,this.text,this.position,this.alignment)},e}(l),I=function(t,e,n){if(n||2===arguments.length)for(var o,i=0,r=e.length;i<r;i++)!o&&i in e||(o||(o=Array.prototype.slice.call(e,0,i)),o[i]=e[i]);return t.concat(o||Array.prototype.slice.call(e))},k=function(){function t(){this.fpsTracker=new H,this.updateTracker=new H,this.renderTracker=new H,this.lateUpdateTracker=new H,this.tracked=new Map,this.shownInfo=[],this.displayed=[]}return t.prototype.updateEngineTickStats=function(t,e,n,o,i){this.fpsTracker.record(t),this.updateTracker.record(e),this.renderTracker.record(n),this.lateUpdateTracker.record(o),this.componentsUpdated=i,this.displayed=I(I(["FPS: ".concat(K(1e3/this.fpsTracker.get())," (").concat(K(this.fpsTracker.get())," ms per frame)"),"update() duration ms: ".concat(K(this.updateTracker.get(),2)),"render() duration ms: ".concat(K(this.renderTracker.get(),2)),"lateUpdate() duration ms: ".concat(K(this.lateUpdateTracker.get(),2)),"components updated: ".concat(this.componentsUpdated)],Array.from(this.tracked.values()).map((function(t){return t[1](t[0].get())})),!0),this.shownInfo,!0),this.shownInfo=[]},t.prototype.customTrackMovingAverage=function(t,e,n){var o=this.tracked.get(t);o||(o=[new H,n],this.tracked.set(t,o)),o[0].record(e)},t.prototype.showInfo=function(t){this.shownInfo.push(t)},t.prototype.getView=function(){var t=h(C.getDimensions().x,20*this.displayed.length+16);return{entities:[new _(I([new O(new b({depth:-1,color:"#0000007F",dimensions:t}))],this.displayed.map((function(t,e){return new O(new U(t,h(10,8+20*e),16,"Arial","white"))})),!0))],zoom:1,offset:p.ZERO}},t}(),K=function(t,e){void 0===e&&(e=0);var n=Math.pow(10,e);return Math.round(t*n)/n},H=function(){function t(){this.pts=[],this.sum=0,this.lifetime=1}return t.prototype.record=function(t){for(var e=(new Date).getTime(),n=e-1e3*this.lifetime;this.pts.length>0&&this.pts[0][0]<n;){var o=this.pts.shift();this.sum-=o[1]}this.pts.push([e,t]),this.sum+=t},t.prototype.get=function(){return this.sum/this.pts.length},t}(),L=new k;function N(t){var e=(new Date).getTime(),n=t();return[(new Date).getTime()-e,n]}var j=function(t,e,n){return Math.min(Math.max(t,e),n)},z=function(){function t(t,e){var n=this;this.tickCounter=1,this.lastUpdateMillis=(new Date).getTime(),this.game=t,this.input=new g(e),C._setCanvas(e),this.game.initialize(),requestAnimationFrame((function(){return n.tick()}))}return t.start=function(e,n){if(!e)throw new Error("game cannot be null");if(!n)throw new Error("canvas cannot be null");new t(e,n)},t.prototype.tick=function(){var t=this,e=(new Date).getTime(),o=j(e-this.lastUpdateMillis,1,66.66666666666667),r=this.input.captureInput(),s={elapsedTimeMillis:o},u=this.game.scene,a=this.getViews(s);m._setViewContext(a);var c=function(e,n){for(var o=0,i=e;o<i.length;o++){var r=i[o];if(t.game.scene!==u)return;n(r)}},p=0,h=N((function(){c(a,(function(e){e.entities=e.entities.filter((function(t){return!!t}));var i=C.getDimensions().div(e.zoom),s={dimensions:i},u={view:e,elapsedTimeMillis:o,input:r.scaledForView(e),dimensions:i,tick:t.tickCounter};c(e.entities,(function(t){return c(t.components,(function(t){t.enabled&&(t.isStarted||(t.start(s),t.start=n),t.update(u),p++)}))}))}))}))[0],l=N((function(){C._render(a)}))[0],f=N((function(){c(a,(function(e){var n={view:e,elapsedTimeMillis:s.elapsedTimeMillis,input:r.scaledForView(e),dimensions:C.getDimensions().div(e.zoom),tick:t.tickCounter};c(e.entities,(function(t){return c(t.components,(function(t){t.lateUpdate(n)}))}))}))}))[0];i.showProfiler&&L.updateEngineTickStats(o,h,l,f,p),this.lastUpdateMillis=e,this.tickCounter++,requestAnimationFrame((function(){return t.tick()}))},t.prototype.getViews=function(t){return this.game.scene.getViews(t).concat(i.showProfiler?[L.getView()]:[])},t}(),F=function(){function t(){}return t.prototype.initialize=function(){},t}(),V=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),W=function(t){function e(e,n,o,i){var r=t.call(this)||this;return r.waitingForInput=!0,r.spawnPos=e,r.player1=n,r.player2=o,r.textDisplay=i,r.spawn(Math.random()>.5?1:-1),r}return V(e,t),e.prototype.update=function(t){if(this.waitingForInput){if(!t.input.isKeyDown(u.SPACE))return;this.waitingForInput=!1}if(this.position=this.position.plus(this.velocity.times(t.elapsedTimeMillis*e.SPEED)),(this.position.y<e.RADIUS&&this.velocity.y<0||this.position.y>t.dimensions.y-e.RADIUS&&this.velocity.y>0)&&(this.velocity=new p(this.velocity.x,-this.velocity.y)),this.velocity.x<0&&this.player1.isColliding(this.position)){var n=this.velocity.y+1.1*this.player1.velocity;this.velocity=new p(-this.velocity.x,n)}else this.velocity.x>0&&this.player2.isColliding(this.position)&&(n=this.velocity.y+1.1*this.player2.velocity,this.velocity=new p(-this.velocity.x,n));this.velocity.magnitude()<1&&(this.velocity=this.velocity.normalized()),this.position.x>t.dimensions.x?(this.textDisplay.playerOneScore++,this.spawn(-1)):this.position.x<0&&(this.textDisplay.playerTwoScore++,this.spawn(1))},e.prototype.getRenderMethods=function(){return[new D({position:this.position.minus(e.SIZE.div(2)),dimensions:e.SIZE,color:"#fff6d3"})]},e.prototype.spawn=function(t){this.position=this.spawnPos,this.velocity=new p(t,3*(Math.random()-1)).normalized(),this.waitingForInput=!0},e.RADIUS=8,e.SIZE=new p(1,1).times(2*e.RADIUS),e.SPEED=.3,e}(e),B=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),G=function(t){function e(e,n,o){var i=t.call(this)||this;return i.pos=e,i.upKey=n,i.downKey=o,i}return B(e,t),e.prototype.update=function(t){this.velocity=0,t.input.isKeyHeld(this.upKey)&&(this.velocity=-1),t.input.isKeyHeld(this.downKey)&&(this.velocity=1);var n=j(this.pos.y+this.velocity*(e.MOVE_SPEED*t.elapsedTimeMillis),0,t.dimensions.y-e.DIMENSIONS.y);this.pos=new p(this.pos.x,n)},e.prototype.isColliding=function(t){return function(t,e,n){return n.x>=t.x&&n.x<t.x+e.x&&n.y>=t.y&&n.y<t.y+e.y}(this.pos,e.DIMENSIONS,t)},e.prototype.getRenderMethods=function(){return[new b({position:this.pos,dimensions:e.DIMENSIONS,color:"#fff6d3"})]},e.PADDING_FROM_EDGE=20,e.DIMENSIONS=new p(16,80),e.MOVE_SPEED=.6,e}(e),Y=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),Z="Lexend Deca",X="#fff6d3",Q=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.playerOneScore=0,e.playerTwoScore=0,e}return Y(e,t),e.prototype.update=function(t){var e=this;this.getRenderMethods=function(){return[new U("".concat(e.playerOneScore," : ").concat(e.playerTwoScore),new p(t.dimensions.x/2,15),30,Z,X,0,"center"),new U("P1: W/S, P2: UP/DOWN, SPACE TO LAUNCH",new p(t.dimensions.x/2,t.dimensions.y-40),20,Z,X,0,"center")]}},e}(e),q=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),J=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return q(e,t),e.prototype.initialize=function(){var t=this,e=C.getDimensions(),n=new Q,o=(e.y-G.DIMENSIONS.y)/2,i=new G(new p(G.PADDING_FROM_EDGE,o),u.W,u.S),r=new G(new p(e.x-G.PADDING_FROM_EDGE-G.DIMENSIONS.x,o),u.UP,u.DOWN),s=new W(e.div(2),i,r,n);this.view={entities:[new _([n]),new _([i]),new _([r]),new _([s])],zoom:1,offset:p.ZERO},this.scene={getViews:function(){return[t.view]}}},e}(F);z.start(new J,document.getElementById("pong-canvas"))})();